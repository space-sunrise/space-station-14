using Content.Client.Message;
using Content.Shared._Sunrise.Roadmap;
using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._Sunrise.Roadmap;

[GenerateTypedNameReferences]
public sealed partial class RoadmapItem : Control
{
    private RoadmapItemState _itemState;

    public RoadmapItemState ItemState
    {
        get => _itemState;
        set
        {
            _itemState = value;
            var panel = (StyleBoxFlat) StateColor.PanelOverride!;
            panel.BackgroundColor = _itemState switch
            {
                RoadmapItemState.Planned => Color.FromHex("#e74c3c"),
                RoadmapItemState.InProgress => Color.FromHex("#3498db"),
                RoadmapItemState.Partial => Color.FromHex("#f1c40f"),
                RoadmapItemState.Complete => Color.FromHex("#2ecc71"),
                _ => Color.Transparent
            };

            StateText.Text = _itemState switch
            {
                RoadmapItemState.Planned => Loc.GetString("ui-roadmap-state-planned"),
                RoadmapItemState.InProgress => Loc.GetString("ui-roadmap-state-in-progress"),
                RoadmapItemState.Partial => Loc.GetString("ui-roadmap-state-partial"),
                RoadmapItemState.Complete => Loc.GetString("ui-roadmap-state-complete"),
                _ => string.Empty
            };
            StateText.ModulateSelfOverride = panel.BackgroundColor;
        }
    }

    public string? HeaderText
    {
        get => HeaderLabel.Text;
        set => HeaderLabel.Text = value;
    }

    public string? Text
    {
        get => Contents.GetMessage();
        set => Contents.SetMarkup($"[font size=11]{value ?? string.Empty}[/font]");
    }

    public RoadmapItem()
    {
        RobustXamlLoader.Load(this);
        HeaderButton.OnPressed += _ => ContentsContainer.Visible = !ContentsContainer.Visible;
    }
}
